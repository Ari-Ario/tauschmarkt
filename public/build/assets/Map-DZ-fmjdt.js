import{_ as W,u as j,r as c,l as z,m as K,a as q,o as u,c as m,b as y,e as b,d as a,n as i,w as Y,j as x,f as Z,v as $,t as J,F as U,S as B,q as O,s as X,x as T,p as ee,h as te,i as oe}from"./app-D8tagWsk.js";import{S as V,P as ae,E as se}from"./index-BeaQipUu.js";import{l as r,s as R,a as ne}from"./locals-BxkJDxKa.js";/* empty css                                                            */var le={VITE_BASE_URL:"https://kleinhaendler.ch/api",VITE_STRIPE_PUBLISHABLE_KEY:"pk_test_51PRVFGCFV0u7TeyesIGWN1GPVFilQQt6QbXmQX540ziEJj7k5F6j3SJ4tuUI6hLrdZdcQNIMZoqeu2lNWzFjn7to00axcktAOT",VITE_PUSHER_APP_KEY:"",VITE_PUSHER_HOST:"",VITE_PUSHER_PORT:"",VITE_PUSHER_SCHEME:"",VITE_PUSHER_APP_CLUSTER:"",BASE_URL:"/build/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const k=v=>(ee("data-v-08a16774"),v=v(),te(),v),re=k(()=>a("div",{class:"back"},[a("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#298E46"},[a("path",{d:"M400-80 0-480l400-400 71 71-329 329 329 329-71 71Z"})])],-1)),ie={class:"map-container"},ce={key:0,class:"controls"},ue=k(()=>a("h4",null,"Auf Ihren Hof klicken",-1)),de={key:1,class:"controls"},pe=k(()=>a("h4",null,"Distanz wÃ¤hlen",-1)),ge={class:"slider-container"},me={__name:"Map",setup(v){const p=j(),E=oe(),w=c(null),s=c({lat:46.938749674988486,lng:7.459564360522899}),n=c(10);c("");const f=c(null),S=c([]),A=le.VUE_APP_GOOGLE_MAP_API_KEY,g=c({center:s.value,radius:n.value*1e3,fillColor:"#0088ff",fillOpacity:.2,strokeColor:"#0088ff",strokeOpacity:.5,strokeWeight:2});z([s,n],()=>{g.value={...g.value,center:s.value,radius:n.value*1e3},P()});const _=()=>{g.value={...g.value,radius:n.value*1e3},P()},C=async()=>{document.querySelector('meta[name="csrf-token"]').getAttribute("content");try{const e=await O.put("/api/user/update-location",r.value);console.log("Location updated:",e.data),B.fire({toast:!0,icon:"success",position:"top-end",showConfirmButton:!1,title:"Ort wurde gespeichert!",timer:3e3})}catch(e){console.error("Error updating profile:",e)}},F=async()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(async e=>{r.value={latitude:e.coords.latitude,longitude:e.coords.longitude},s.value={lat:e.coords.latitude,lng:e.coords.longitude},_(),await C(),await L(r.value.latitude,r.value.longitude,n.value,p.authUser.id),closeDetails(),B.fire({toast:!0,icon:"success",position:"top-end",showConfirmButton:!1,title:"Standort wurde gespeichert!",timer:3e3})}):alert("Geolocation is not supported by this browser.")},M=()=>{C()},D=e=>{if(e.geometry){s.value={lat:e.geometry.location.lat(),lng:e.geometry.location.lng()},r.value={latitude:e.geometry.location.lat(),longitude:e.geometry.location.lng()},_();const t=e.address_components;let l="";for(const o of t)if(o.types.includes("locality")){l=o.long_name;break}console.log(`City: ${l}`)}else console.error("Place has no geometry")},P=()=>{if(f.value){const e=new google.maps.LatLngBounds,t=new google.maps.LatLng(s.value.lat,s.value.lng),l=n.value*1e3,o=google.maps.geometry.spherical.computeOffset(t,l,45),d=google.maps.geometry.spherical.computeOffset(t,l,225);e.extend(t),e.extend(o),e.extend(d),f.value.fitBounds(e)}},H=e=>{s.value={lat:e.latLng.lat(),lng:e.latLng.lng()},r.value={latitude:e.latLng.lat(),longitude:e.latLng.lng()},_()},L=async(e,t,l,o)=>{try{const d=await O.get(`/api/enterprises/${o}`,{params:{latitude:e,longitude:t,distance:l}});S.value=d.data}catch(d){console.error("Error loading enterprises:",d)}},I=K(async()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(async e=>{w.value={lat:e.coords.latitude,lng:e.coords.longitude},s.value=w.value,r.value={latitude:e.coords.latitude,longitude:e.coords.longitude},await L(r.value.latitude,r.value.longitude,n.value,p.authUser.id)}):console.error("Geolocation is not supported by this browser.")}),h=c(null),G=()=>{if(h.value)return;const e=document.getElementById("autocomplete");h.value=new google.maps.places.Autocomplete(e,{types:["(cities)"]}),h.value.addListener("place_changed",()=>{const t=h.value.getPlace();if(t.geometry){const l=t.geometry.location.lat(),o=t.geometry.location.lng();R(l,o),console.log(`City: ${t.formatted_address}`)}else console.error("Place has no geometry")})},N=e=>{E.push({name:"index",params:{id:e}})},Q=()=>{R(r.value.latitude,r.value.longitude),ne(n.value),E.push({name:"dashboard"})};return(e,t)=>{const l=q("router-link");return u(),m(U,null,[y(l,{to:{name:"dashboard"},class:"link"},{default:b(()=>[re]),_:1}),a("div",ie,[y(i(se),{"api-key":i(A),center:s.value,zoom:10,style:{width:"100%",height:"100%"},onLoad:t[0]||(t[0]=o=>f.value.value=o),onClick:H},{default:b(()=>[(u(!0),m(U,null,X(S.value,o=>(u(),T(i(V),{key:o.id,options:{center:{lat:parseFloat(o.latitude),lng:parseFloat(o.longitude)},radius:500,fillColor:"#FF0000",fillOpacity:.5,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2},onClick:()=>N(o.id)},null,8,["options","onClick"]))),128)),i(p).authUser.is_seller?x("",!0):(u(),T(i(V),{key:0,options:g.value},null,8,["options"])),y(i(ae),{options:{position:s.value}},null,8,["options"])]),_:1},8,["api-key","center"]),a("form",{onSubmit:t[2]||(t[2]=Y((...o)=>i(I)&&i(I)(...o),["prevent"])),class:"location-form"},[i(p).authUser.is_seller?(u(),m("div",ce,[ue,i(p).authUser.is_seller?(u(),m("button",{key:0,onClick:M},"Ort speichern")):x("",!0),a("button",{onClick:F},"Meinen Standort verwenden")])):(u(),m("div",de,[a("input",{id:"autocomplete",type:"text",placeholder:"Enter a city or location",onFocus:G},null,32),a("button",{onClick:D},"Stadt suchen"),pe,a("div",ge,[Z(a("input",{type:"range",min:"1",max:"20","onUpdate:modelValue":t[1]||(t[1]=o=>n.value=o),onInput:_},null,544),[[$,n.value]]),a("span",null,J(n.value)+" km",1)]),a("button",{onClick:Q},"Suchen")]))],32)])],64)}}},ye=W(me,[["__scopeId","data-v-08a16774"]]);export{ye as default};
