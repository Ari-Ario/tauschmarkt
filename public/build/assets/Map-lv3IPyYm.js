import{_ as $,u as q,r as c,i as z,j as K,a as j,o as u,c as m,b as _,e as P,d as a,k as i,w as H,q as B,f as Y,v as Z,t as J,F as M,l as O,m as Q,n as A,p as X,g as ee,h as te}from"./app-LPhj_kXP.js";import{S as I,P as oe,E as ae}from"./index-Dmyk4TA5.js";import{l as r,s as F,a as ne}from"./locals-DctRchG1.js";/* empty css                                                            */var le={VITE_BASE_URL:"http://localhost/api",BASE_URL:"/build/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const k=v=>(X("data-v-95f2a300"),v=v(),ee(),v),se=k(()=>a("div",{class:"back"},[a("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#298E46"},[a("path",{d:"M400-80 0-480l400-400 71 71-329 329 329 329-71 71Z"})])],-1)),re={class:"map-container"},ie={key:0,class:"controls"},ce=k(()=>a("h4",null,"Auf Ihren Hof klicken",-1)),ue={key:1,class:"controls"},de=k(()=>a("h4",null,"Distanz wÃ¤hlen",-1)),pe={class:"slider-container"},ge={__name:"Map",setup(v){const p=q(),w=te(),C=c(null),n=c({lat:46.938749674988486,lng:7.459564360522899}),l=c(10);c("");const f=c(null),E=c([]),U=le.VUE_APP_GOOGLE_MAP_API_KEY,g=c({center:n.value,radius:l.value*1e3,fillColor:"#0088ff",fillOpacity:.2,strokeColor:"#0088ff",strokeOpacity:.5,strokeWeight:2});z([n,l],()=>{g.value={...g.value,center:n.value,radius:l.value*1e3},b()});const h=()=>{g.value={...g.value,radius:l.value*1e3},b()},L=async()=>{document.querySelector('meta[name="csrf-token"]').getAttribute("content");try{const e=await O.put("/api/user/update-location",r.value);console.log("Location updated:",e.data)}catch(e){console.error("Error updating profile:",e)}},D=async()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(async e=>{r.value={latitude:e.coords.latitude,longitude:e.coords.longitude},n.value={lat:e.coords.latitude,lng:e.coords.longitude},h(),await L(),await x(r.value.latitude,r.value.longitude,l.value,p.authUser.id)}):alert("Geolocation is not supported by this browser.")},V=()=>{L()},R=e=>{if(e.geometry){n.value={lat:e.geometry.location.lat(),lng:e.geometry.location.lng()},r.value={latitude:e.geometry.location.lat(),longitude:e.geometry.location.lng()},h();const t=e.address_components;let s="";for(const o of t)if(o.types.includes("locality")){s=o.long_name;break}console.log(`City: ${s}`)}else console.error("Place has no geometry")},b=()=>{if(f.value){const e=new google.maps.LatLngBounds,t=new google.maps.LatLng(n.value.lat,n.value.lng),s=l.value*1e3,o=google.maps.geometry.spherical.computeOffset(t,s,45),d=google.maps.geometry.spherical.computeOffset(t,s,225);e.extend(t),e.extend(o),e.extend(d),f.value.fitBounds(e)}},G=e=>{n.value={lat:e.latLng.lat(),lng:e.latLng.lng()},r.value={latitude:e.latLng.lat(),longitude:e.latLng.lng()},h()},x=async(e,t,s,o)=>{try{const d=await O.get(`/api/enterprises/${o}`,{params:{latitude:e,longitude:t,distance:s}});E.value=d.data}catch(d){console.error("Error loading enterprises:",d)}},S=K(async()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(async e=>{C.value={lat:e.coords.latitude,lng:e.coords.longitude},n.value=C.value,r.value={latitude:e.coords.latitude,longitude:e.coords.longitude},await x(r.value.latitude,r.value.longitude,l.value,p.authUser.id)}):console.error("Geolocation is not supported by this browser.")}),y=c(null),T=()=>{if(y.value)return;const e=document.getElementById("autocomplete");y.value=new google.maps.places.Autocomplete(e,{types:["(cities)"]}),y.value.addListener("place_changed",()=>{const t=y.value.getPlace();if(t.geometry){const s=t.geometry.location.lat(),o=t.geometry.location.lng();F(s,o),console.log(`City: ${t.formatted_address}`)}else console.error("Place has no geometry")})},N=e=>{w.push({name:"index",params:{id:e}})},W=()=>{F(r.value.latitude,r.value.longitude),ne(l.value),w.push({name:"dashboard"})};return(e,t)=>{const s=j("router-link");return u(),m(M,null,[_(s,{to:{name:"dashboard"},class:"link"},{default:P(()=>[se]),_:1}),a("div",re,[_(i(ae),{"api-key":i(U),center:n.value,zoom:10,style:{width:"100%",height:"100%"},onLoad:t[0]||(t[0]=o=>f.value.value=o),onClick:G},{default:P(()=>[(u(!0),m(M,null,Q(E.value,o=>(u(),A(i(I),{key:o.id,options:{center:{lat:parseFloat(o.latitude),lng:parseFloat(o.longitude)},radius:500,fillColor:"#FF0000",fillOpacity:.5,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2},onClick:()=>N(o.id)},null,8,["options","onClick"]))),128)),i(p).authUser.is_seller?B("",!0):(u(),A(i(I),{key:0,options:g.value},null,8,["options"])),_(i(oe),{options:{position:n.value}},null,8,["options"])]),_:1},8,["api-key","center"]),a("form",{onSubmit:t[2]||(t[2]=H((...o)=>i(S)&&i(S)(...o),["prevent"])),class:"location-form"},[i(p).authUser.is_seller?(u(),m("div",ie,[ce,i(p).authUser.is_seller?(u(),m("button",{key:0,onClick:V},"Ort speichern")):B("",!0),a("button",{onClick:D},"Meinen Standort verwenden")])):(u(),m("div",ue,[a("input",{id:"autocomplete",type:"text",placeholder:"Enter a city or location",onFocus:T},null,32),a("button",{onClick:R},"Stadt suchen"),de,a("div",pe,[Y(a("input",{type:"range",min:"1",max:"20","onUpdate:modelValue":t[1]||(t[1]=o=>l.value=o),onInput:h},null,544),[[Z,l.value]]),a("span",null,J(l.value)+" km",1)]),a("button",{onClick:W},"Suchen")]))],32)])],64)}}},fe=$(ge,[["__scopeId","data-v-95f2a300"]]);export{fe as default};
