import{_ as T,Q as q,M as g,o as i,c as r,d as e,F as I,m as E,k as A,t as u,w as m,h as B,D as M,f as P,v as $,p as R,g as F,S as l}from"./app-LPhj_kXP.js";import{u as Z,l as D}from"./CartList.vue_vue_type_style_index_0_scoped_444ccb5a_lang-BhsvUD8N.js";var N={VITE_BASE_URL:"http://localhost/api",BASE_URL:"/build/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const c=n=>(R("data-v-444ccb5a"),n=n(),F(),n),U={class:"body"},L={class:"container px-5 py-24 mx-auto flex sm:flex-nowrap flex-wrap"},O={class:"lg:w-2/3 md:w-1/2 rounded-lg"},V={class:"table table-striped"},H=c(()=>e("thead",{class:"thead-dark"},[e("tr",null,[e("th",{scope:"col"},"Bild"),e("th",{scope:"col"},"Produkt"),e("th",{scope:"col"},"Menge"),e("th",{scope:"col"},"Preis"),e("th",{scope:"col"},"Akt")])],-1)),K={class:"product-image w-32 p-4"},z=["src"],X={key:1,src:"https://upload.wikimedia.org/wikipedia/commons/thumb/6/65/No-Image-Placeholder.svg/330px-No-Image-Placeholder.svg.png",alt:"No Image Available",class:"img-thumbnail"},j={class:"font-weight-bold text-dark"},Q={class:"d-flex align-items-center"},G=["onClick","disabled"],Y=c(()=>e("i",{class:"bi bi-dash"},"-",-1)),J=[Y],W=["onUpdate:modelValue"],ee=["onClick"],te=c(()=>e("i",{class:"bi bi-plus"},"+",-1)),se=[te],oe={class:"font-weight-bold text-dark"},ae=["onClick"],ne=c(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#EA3323"},[e("path",{d:"M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"})],-1)),ie=[ne],re={class:"details md:w-1/2 bg-white flex mt-8"},le=c(()=>e("h2",{class:"text-dark mb-4"},"Zusammenfassung",-1)),ce={class:"mb-5 text-muted"},de={key:0},ue=c(()=>e("h2",{class:"text-dark mb-4"},"Shipping Address",-1)),he={class:"text-muted mb-5"},me=c(()=>e("p",{class:"text-muted mb-5"},"or you can add new below",-1)),pe={__name:"CartList",props:{userAddress:Object},setup(n){const v=B(),d=q({address1:null,state:null,city:null,zipcode:null,country_code:null,type:null});g(()=>d.address1!==null&&d.state!==null&&d.city!==null&&d.zipcode!==null&&d.country_code!==null&&d.type!==null);const{cartItems:h,cartCount:_e,addToCart:b,removeItemFromCart:y,removeFromCart:w,updateQuantity:fe}=Z(),p=h,_=g(()=>p.value.reduce((t,a)=>t+a.price*a.quantity,0)),k=t=>{const a=document.querySelector('meta[name="csrf-token"]').getAttribute("content");console.log(t),axios.post(`/api/cart/store/${t.id}`,t,{quantity:t.quantity,price:t.price,seller_id:t.seller_id},{headers:{"Content-Type":"multipart/form-data","X-CSRF-TOKEN":a}}).then(s=>{const o=s.data.flash;o&&o.success&&l.fire({toast:!0,icon:"success",position:"top-end",showConfirmButton:!1,title:o.success,timer:3e3}),b(t)}).catch(s=>{console.error("Error adding to cart:",s)})},x=t=>{const a=document.querySelector('meta[name="csrf-token"]').getAttribute("content");axios.post(`/api/cart/remove/${t.id}`,t,{quantity:t.quantity,price:t.price,seller_id:t.seller_id},{headers:{"Content-Type":"multipart/form-data","X-CSRF-TOKEN":a}}).then(s=>{const o=s.data.flash;o&&l.fire({toast:!0,icon:"success",position:"top-end",showConfirmButton:!1,title:o.success,timer:3e3}),y(t)}).catch(s=>{console.error("Error adding to cart:",s)})},C=t=>{const a=document.querySelector('meta[name="csrf-token"]').getAttribute("content");axios.delete(`/api/delete/update/${t.id}`,{seller_id:t.seller_id},{headers:{"Content-Type":"multipart/form-data","X-CSRF-TOKEN":a}}).then(s=>{const o=s.data.flash;o&&o.success&&l.fire({toast:!0,icon:"success",position:"top-end",showConfirmButton:!1,title:o.success,timer:3e3}),w(t.id)}).catch(s=>{console.error("Error adding to cart:",s),l.fire({toast:!0,icon:"error",position:"top-end",showConfirmButton:!1,title:"Produkt wurde nicht gepostet!"})})};D(String(N.STRIPE_KEY));async function S(){const t=h.value,a=null;if(t.length===0)return;let s=t[0].seller_id;for(let o=1;o<t.length;o++)t[o].seller_id!==s&&(console.log(`Seller ID mismatch: ${t[o].seller_id} is not equal to ${s}`),l.fire({toast:!0,icon:"error",position:"top-end",showConfirmButton:!1,title:"Ups, fehler. Sie kÃ¶nnen jedes Mal nur bei einem Stand kaufen!"}),a="IdMissmatch");a&&a==="IdMissmatch"||axios.post("/api/checkout/order",{carts:h.value,products:h.value.map(o=>({id:o.id,name:o.name,price:o.price})),total:_.value,seller_id:h.value[0].seller_id}).then(o=>{o.data.url&&(window.location.href=o.data.url),l.fire({toast:!0,icon:"success",position:"top-end",showConfirmButton:!1,title:"Zahlung erfolgreich!",timer:3e3})}).catch(o=>{console.error("There was an error during the checkout process:",o),l.fire({toast:!0,icon:"error",position:"top-end",showConfirmButton:!1,title:"Ups, fehler.Versuchen Sie noch einmal!"})})}const f=new URLSearchParams(window.location.search).get("session_id");return f&&axios.get("/api/checkout/success",{params:{session_id:f}}).then(t=>{v.push("/")}).catch(t=>{console.error("There was an error during the payment success handling:",t)}),(t,a)=>(i(),r("section",U,[e("div",L,[e("div",O,[e("table",V,[H,e("tbody",null,[(i(!0),r(I,null,E(A(p),s=>(i(),r("tr",{key:s.id},[e("td",K,[s.product_images&&s.product_images.length>0?(i(),r("img",{key:0,src:`/${s.product_images[0].image}`,alt:"Product Image",class:"img-thumbnail"},null,8,z)):(i(),r("img",X))]),e("td",j,u(s.name),1),e("td",null,[e("div",Q,[e("button",{onClick:m(o=>x(s),["prevent"]),disabled:s.quantity<=1,class:M(["btn","btn-outline-secondary",s.quantity>1?"text-primary":"disabled"]),type:"button"},J,10,G),P(e("input",{type:"number","onUpdate:modelValue":o=>s.quantity=o,class:"form-control qty w-25 mx-2",placeholder:"1",style:{"max-width":"40px"},required:""},null,8,W),[[$,s.quantity]]),e("button",{onClick:m(o=>k(s),["prevent"]),class:"btn btn-outline-secondary text-primary",type:"button"},se,8,ee)])]),e("td",oe," $"+u(s.price),1),e("td",null,[e("div",{onClick:o=>C(s)},ie,8,ae)])]))),128))])])]),e("div",re,[le,e("p",ce,"Gesamt: "+u(_.value)+" CHF",1),n.userAddress?(i(),r("div",de,[ue,e("p",he,u(n.userAddress.address1)+" , "+u(n.userAddress.city)+", "+u(n.userAddress.zipcode),1),me])):(i(),r("button",{key:1,onClick:a[0]||(a[0]=m(s=>S(),["prevent"])),type:"submit",class:"btn btn-secondary"},"Zur Kasse"))])])]))}},ye=T(pe,[["__scopeId","data-v-444ccb5a"]]);export{ye as default};
