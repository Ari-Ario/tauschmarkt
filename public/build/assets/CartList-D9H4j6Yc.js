import{_ as P,Q as q,N as b,o as r,c as l,b as R,d as e,F as w,s as A,n as B,t as u,w as _,i as V,G as H,f as U,v as F,p as Q,h as M,S as a}from"./app-D8tagWsk.js";import{u as N,l as $,H as L}from"./Header-BmOdKlL7.js";var Z={VITE_BASE_URL:"https://kleinhaendler.ch/api",VITE_STRIPE_PUBLISHABLE_KEY:"pk_test_51PRVFGCFV0u7TeyesIGWN1GPVFilQQt6QbXmQX540ziEJj7k5F6j3SJ4tuUI6hLrdZdcQNIMZoqeu2lNWzFjn7to00axcktAOT",VITE_PUSHER_APP_KEY:"",VITE_PUSHER_HOST:"",VITE_PUSHER_PORT:"",VITE_PUSHER_SCHEME:"",VITE_PUSHER_APP_CLUSTER:"",BASE_URL:"/build/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const c=i=>(Q("data-v-8f8393db"),i=i(),M(),i),O={class:"body"},K={class:"container px-5 py-24 mx-auto flex sm:flex-nowrap flex-wrap"},z={class:"lg:w-2/3 md:w-1/2 rounded-lg"},D={class:"table table-striped"},j=c(()=>e("thead",{class:"thead-dark"},[e("tr",null,[e("th",{scope:"col"},"Bild"),e("th",{scope:"col"},"Produkt"),e("th",{scope:"col"},"Menge"),e("th",{scope:"col"},"Preis"),e("th",{scope:"col"},"Akt")])],-1)),G={class:"product-image w-32 p-4"},X=["src"],W={key:1,src:"https://upload.wikimedia.org/wikipedia/commons/thumb/6/65/No-Image-Placeholder.svg/330px-No-Image-Placeholder.svg.png",alt:"No Image Available",class:"img-thumbnail"},Y={class:"font-weight-bold text-dark"},J={class:"d-flex align-items-center"},tt=["onClick","disabled"],et=c(()=>e("i",{class:"bi bi-dash"},"-",-1)),st=[et],ot=["onUpdate:modelValue","onChange"],nt=["onClick"],at=c(()=>e("i",{class:"bi bi-plus"},"+",-1)),it=[at],rt={class:"font-weight-bold text-dark"},lt=["onClick"],ct=c(()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#EA3323"},[e("path",{d:"M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"})],-1)),dt=[ct],ut={class:"details md:w-1/2 bg-white flex mt-8"},ht=c(()=>e("h2",{class:"text-dark mb-4"},"Zusammenfassung",-1)),mt={class:"mb-5 text-muted"},_t={key:0},pt=c(()=>e("h2",{class:"text-dark mb-4"},"Shipping Address",-1)),ft={class:"text-muted mb-5"},gt=c(()=>e("p",{class:"text-muted mb-5"},"or you can add new below",-1)),vt={__name:"CartList",props:{userAddress:Object},setup(i){const k=V(),d=q({address1:null,state:null,city:null,zipcode:null,country_code:null,type:null});b(()=>d.address1!==null&&d.state!==null&&d.city!==null&&d.zipcode!==null&&d.country_code!==null&&d.type!==null);const{cartItems:h,cartCount:yt,addToCart:C,removeItemFromCart:S,removeFromCart:x,updateQuantity:bt,getExistingProduct:p}=N(),f=h,g=b(()=>f.value.reduce((s,n)=>s+n.price*n.quantity,0)),v=s=>{const n=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),t=p(s.id);if(t&&t.quantity==t.totalQuantity){a.fire({toast:!0,icon:"info",position:"top-end",showConfirmButton:!1,title:"Ihr Wahl ist gleich der übrigen Quantität: ",timer:3e3}),t.quantity=t.totalQuantity;return}if(t&&t.quantity>t.totalQuantity){a.fire({toast:!0,icon:"error",position:"top-end",showConfirmButton:!1,title:"Ihr Wahl ist mehr als übrige Quantität: ",timer:3e3}),t.quantity=t.totalQuantity;return}axios.post(`/api/cart/store/${s.id}`,s,{quantity:s.quantity,price:s.price,seller_id:s.seller_id},{headers:{"Content-Type":"multipart/form-data","X-CSRF-TOKEN":n}}).then(o=>{const m=o.data.flash;m&&m.success&&a.fire({toast:!0,icon:"success",position:"top-end",showConfirmButton:!1,title:m.success,timer:3e3}),C(s)}).catch(o=>{console.error("Error adding to cart:",o)})},E=s=>{const n=document.querySelector('meta[name="csrf-token"]').getAttribute("content");p(s.id),axios.post(`/api/cart/remove/${s.id}`,s,{quantity:s.quantity,price:s.price,seller_id:s.seller_id},{headers:{"Content-Type":"multipart/form-data","X-CSRF-TOKEN":n}}).then(t=>{const o=t.data.flash;o&&a.fire({toast:!0,icon:"success",position:"top-end",showConfirmButton:!1,title:o.success,timer:3e3}),S(s)}).catch(t=>{console.error("Error adding to cart:",t)})},I=s=>{const n=document.querySelector('meta[name="csrf-token"]').getAttribute("content");axios.delete(`/api/delete/update/${s.id}`,{seller_id:s.seller_id},{headers:{"Content-Type":"multipart/form-data","X-CSRF-TOKEN":n}}).then(t=>{const o=t.data.flash;o&&o.success&&a.fire({toast:!0,icon:"success",position:"top-end",showConfirmButton:!1,title:o.success,timer:3e3}),x(s.id)}).catch(t=>{console.error("Error adding to cart:",t),a.fire({toast:!0,icon:"error",position:"top-end",showConfirmButton:!1,title:"Produkt wurde nicht gepostet!"})})};$(String(Z.STRIPE_KEY));async function T(){const s=h.value,n=null;if(s.length===0)return;let t=s[0].seller_id;for(let o=1;o<s.length;o++)s[o].seller_id!==t&&(console.log(`Seller ID mismatch: ${s[o].seller_id} is not equal to ${t}`),a.fire({toast:!0,icon:"error",position:"top-end",showConfirmButton:!1,title:"Ups, fehler. Sie können jedes Mal nur bei einem Stand kaufen!"}),n="IdMissmatch");n&&n==="IdMissmatch"||axios.post("/api/checkout/order",{carts:h.value,products:h.value.map(o=>({id:o.id,name:o.name,price:o.price})),total:g.value,seller_id:h.value[0].seller_id}).then(o=>{localStorage.removeItem("cart"),o.data.url&&(window.location.href=o.data.url),a.fire({toast:!0,icon:"success",position:"top-end",showConfirmButton:!1,title:"Zahlung erfolgreich!",timer:3e3})}).catch(o=>{console.error("There was an error during the checkout process:",o),a.fire({toast:!0,icon:"error",position:"top-end",showConfirmButton:!1,title:"Ups, fehler.Versuchen Sie noch einmal!"})})}const y=new URLSearchParams(window.location.search).get("session_id");return y&&axios.get("/api/checkout/success",{params:{session_id:y}}).then(s=>{k.push("/")}).catch(s=>{console.error("There was an error during the payment success handling:",s)}),(s,n)=>(r(),l(w,null,[R(L),e("section",O,[e("div",K,[e("div",z,[e("table",D,[j,e("tbody",null,[(r(!0),l(w,null,A(B(f),t=>(r(),l("tr",{key:t.id},[e("td",G,[t.product_images&&t.product_images.length>0?(r(),l("img",{key:0,src:`/${t.product_images[0].image}`,alt:"Product Image",class:"img-thumbnail"},null,8,X)):(r(),l("img",W))]),e("td",Y,u(t.name),1),e("td",null,[e("div",J,[e("button",{onClick:_(o=>E(t),["prevent"]),disabled:t.quantity<=1,class:H(["btn","btn-outline-secondary",t.quantity>1?"text-primary":"disabled"]),type:"button"},st,10,tt),U(e("input",{type:"number","onUpdate:modelValue":o=>t.quantity=o,class:"form-control qty w-25 mx-2",placeholder:"1",style:{"max-width":"40px"},onChange:o=>v(t),required:""},null,40,ot),[[F,t.quantity]]),e("button",{onClick:_(o=>v(t),["prevent"]),class:"btn btn-outline-secondary text-primary",type:"button"},it,8,nt)])]),e("td",rt,u(t.price),1),e("td",null,[e("div",{onClick:o=>I(t)},dt,8,lt)])]))),128))])])]),e("div",ut,[ht,e("p",mt,"Gesamt: "+u(g.value)+" CHF",1),i.userAddress?(r(),l("div",_t,[pt,e("p",ft,u(i.userAddress.address1)+" , "+u(i.userAddress.city)+", "+u(i.userAddress.zipcode),1),gt])):(r(),l("button",{key:1,onClick:n[0]||(n[0]=_(t=>T(),["prevent"])),type:"submit",class:"btn btn-secondary"},"Zur Kasse"))])])])],64))}},St=P(vt,[["__scopeId","data-v-8f8393db"]]);export{St as default};
